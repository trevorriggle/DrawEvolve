ğŸ“˜ DrawEvolve iPad Foundation Audit + Stabilization Plan (v1.1)

Author

Trevor Riggle (RIG Tech) â€” October 2025
Last Updated: October 12, 2025

â¸»

1ï¸âƒ£ Project Context

DrawEvolve is an iOS-first AI-assisted drawing app built with Next.js (for backend web) and native SwiftUI/Metal for iPad. Its mission: help artists evolve their technique through personalized, non-judgmental feedback while keeping the human act of drawing first.

This audit follows the first live iPad build, where on-device canvas testing exposed early structural and UX-level bugs.

Goal: stabilize foundation before adding advanced features (social, critique history, user feeds, etc.).

âœ… PROGRESS UPDATE: Several P0 and P1 issues have been resolved. See section 10 for detailed status.

2ï¸âƒ£ Full Bug & Issue List (Transcribed)

From handwritten notes:

- Need landing screen, loads too fast â†’ â€œDrawEvolve Continueâ€
- Dark mode? Toggle?
- Onboarding â€” use â€œpersonalized,â€ not â€œAIâ€
- Canvas setup â€” when horizontal, 2Ã—2 input fields
- Dark mode: gallery thumbnails need white bg
- Re-entering drawing: canâ€™t save (overwrite) or get AI feedback
- Need dark/light mode logo variants
- Gallery can be broken when creating new art or revisiting drawings
- Need loading, app icon, app name
- Brush strokes get thicker when release
- Feedback markdown rendering
- Canvas: no zoom
- Canvas rotation distorts drawing
- Finish selection tools
- Critique history (Pencil UI + timestamp)
- Gallery traps you (canâ€™t get back to drawing; redundant profile icon)
- Auth?

3ï¸âƒ£ Priority Breakdown
Priority	Type	Task	Est. Hours	Description
ğŸŸ¥ P0	Core Bug	Gallery trap / return-to-drawing failure	3â€“4	Router/state machine refactor
ğŸŸ¥ P0	Core Bug	Re-enter drawing canâ€™t save/overwrite	4	Autosave, versioned bundle
ğŸŸ¥ P0	Core UX	Canvas rotation distorts drawing	5â€“6	Maintain doc-space coordinates
ğŸŸ¥ P0	Core UX	No zoom	4â€“5	Add pinch/scroll gesture layer
ğŸŸ¥ P0	Core System	Gallery breaks on new/revisit	3â€“4	Async transactional writes
ğŸŸ§ P1	UX	Landing screen loads too fast	2	Add skeleton + â€œContinueâ€
ğŸŸ§ P1	Brush	Brush thickens on release	3	Clamp width post-smoothing
ğŸŸ§ P1	UI	Dark mode toggle + logo variants	2â€“3	Asset swap, system preference
ğŸŸ§ P1	UI	Dark mode thumbnails need bg	1	Style fix
ğŸŸ§ P1	Feedback	Markdown rendering	2	AttributedString(markdown:)
ğŸŸ§ P1	Copy	Onboarding tone (â€œpersonalizedâ€)	1	UX copy edit
ğŸŸ¨ P2	UI	Loading screen, app icon, name	2â€“3	Launch storyboard pass
ğŸŸ¨ P2	Feature	Critique history	4â€“6	Log + UI
ğŸŸ¨ P2	Feature	Selection tools	5â€“8	Implement or hide
ğŸŸ¨ P2	System	Auth?	TBD	Sign in w/ Apple or guest mode

Totals:
	â€¢	P0: ~25h
	â€¢	P1: ~12h
	â€¢	P2: ~14h
â†’ ~1 focused week of stabilization for TestFlight readiness.

â¸»

4ï¸âƒ£ Potential Foundational Risks

A. Navigation & State Machine
	â€¢	Smell: Multiple sources of truth (e.g., view controller state vs. app state).
	â€¢	Fix: Create one reducer-style state machine:

enum Mode { case gallery, editor, feedback }
struct AppState { var mode: Mode; var currentDocId: UUID? }

B. Document Lifecycle
	â€¢	Smell: Re-entering drawing doesnâ€™t save properly.
	â€¢	Fix: Treat each drawing as a .drawevolve bundle containing JSON model, preview PNG, critique log. Autosave on brush lift + background.

C. Coordinate System / Transform
	â€¢	Smell: Rotation distorts strokes.
	â€¢	Fix: Store all strokes in document coordinates; view layer only applies a single transform matrix.

D. Input Pipeline
	â€¢	Smell: Stroke width changes on touchesEnded.
	â€¢	Fix: Freeze width at last coalesced Pencil sample. End event closes geometry only.

E. Async Persistence
	â€¢	Smell: Gallery breaks when creating or revisiting docs.
	â€¢	Fix: Make doc writes atomic: only show gallery updates after save completes.

â¸»

5ï¸âƒ£ Key Invariants to Lock Down
	1.	Single source of truth:
Only one AppState controls navigation and document IDs.
	2.	Document-space consistency:
Strokes, layers, selections live in doc coordinates â€” never view coordinates.
	3.	Transactional persistence:
Every create/open/save action is atomic and returns the same doc version.
	4.	Input determinism:
Pencil input pipeline = samples â†’ smooth â†’ width â†’ mesh. End events never modify stroke data.
	5.	Autosave & recovery:
Always recoverable without user intervention. App kill â†’ relaunch = doc restored.

â¸»

6ï¸âƒ£ Diagnostic Checklist

âœ… State audit â€” ensure only one currentDocId
âœ… Transform audit â€” doc-space invariants hold during zoom/rotation
âœ… Autosave probe â€” kill app mid-stroke, relaunch
âœ… Concurrency probe â€” hammer create/open cycles
âœ… End-event check â€” log width stability

â¸»

7ï¸âƒ£ Stabilization Sprint Plan (5 Days)

Day 1â€“2:
	â€¢	Router refactor
	â€¢	Document lifecycle
	â€¢	Autosave & preview versioning

Day 3:
	â€¢	Transform matrix cleanup
	â€¢	Zoom & rotation fix

Day 4:
	â€¢	Brush width finalization
	â€¢	Dark/light UI assets
	â€¢	Loading skeleton

Day 5:
	â€¢	Markdown renderer
	â€¢	Copy polish
	â€¢	Hide unfinished tools
	â€¢	Smoke test â†’ TestFlight build

â¸»

8ï¸âƒ£ Next Milestone: Post-Stabilization

Once this sprint passes:
	â€¢	Introduce Accounts (guest â†’ Apple Sign-In)
	â€¢	Critique History Log
	â€¢	Layer System QA
	â€¢	AI Coach Iteration (Feedback Engine v2)
	â€¢	Social Features (Phase II) â€” only when doc model + sync are bulletproof.

â¸»

9ï¸âƒ£ Mindset Recap

You caught the perfect inflection point:

"From functional prototype to reliable app."

This stabilization cycle isn't a slowdown â€” it's the multiplier that makes every next feature safe, testable, and scalable.

â¸»

ğŸ”Ÿ Completed Fixes (October 12, 2025)

âœ… P0 FIXES COMPLETED:

1. **Gallery trap / return-to-drawing failure** âœ… FIXED
   - Status: RESOLVED
   - Solution: Added "Close" button in gallery navigation, fixed gallery button visibility
   - Commits: 51ddc3e, 06e942d, 1b86736
   - Details: Gallery now has proper navigation controls. Gallery button always visible in canvas, even when toolbar collapsed, ensuring users can navigate back from any state.

2. **Re-enter drawing can't save/overwrite** âœ… FIXED
   - Status: RESOLVED
   - Solution: Implemented proper currentDrawingID tracking and update logic
   - Commits: 7c965a0, 3ddf92c
   - Details: Save/overwrite now works correctly. System tracks currentDrawingID and updates existing drawings instead of creating duplicates. Save and Feedback buttons properly enabled after loading existing drawings via hasLoadedExistingImage flag.

3. **Gallery breaks on new/revisit** âœ… FIXED
   - Status: RESOLVED
   - Solution: Fixed gallery thumbnails with proper GeometryReader, fixed save logic
   - Commits: 3ddf92c
   - Details: Gallery thumbnails now render correctly with proper centering and aspect ratio. Save operations are atomic and consistent.

âœ… P1 FIXES COMPLETED:

1. **Dark mode thumbnails need bg** âœ… FIXED
   - Status: RESOLVED
   - Solution: Added white background to gallery thumbnails, changed border to adaptive color
   - File: GalleryView.swift:197
   - Details: Thumbnails now display properly in dark mode with white background and adaptive border (primary.opacity(0.2)).

2. **Onboarding tone ("personalized")** âœ… FIXED
   - Status: RESOLVED
   - Solution: Updated all "AI" references to "personalized" in onboarding
   - File: OnboardingPopup.swift:34, 60-61
   - Details: Changed "AI-powered drawing coach" to "personalized drawing coach" and "Get AI feedback" to "Get personalized feedback" throughout onboarding flow.

3. **Markdown rendering** âœ… IMPROVED
   - Status: RESOLVED
   - Solution: Implemented native SwiftUI AttributedString markdown with fallback parser
   - Files: FeedbackOverlay.swift:112-218, FloatingFeedbackPanel.swift:57
   - Details: Now uses iOS native markdown rendering (AttributedString) with proper formatting. Falls back to custom parser if needed. Applied to both FeedbackOverlay and FloatingFeedbackPanel.

4. **Dark mode toggle + logo variants** âœ… FIXED
   - Status: RESOLVED
   - Solution: Added dark mode toggle button with moon/sun icons, cycles through system/light/dark modes
   - File: DrawingCanvasView.swift:46, 203-209, 508-533
   - Details: Toggle button in toolbar with moon.fill icon (light mode) and sun.max.fill icon (dark mode). Uses @AppStorage for persistence. Cycles: system â†’ light â†’ dark â†’ system. Applies .preferredColorScheme modifier to entire view.

âœ… P2 FIXES COMPLETED:

1. **Selection tools** âœ… FIXED
   - Status: RESOLVED
   - Solution: Implemented complete selection tools with marching ants UI, pixel extraction, and touch-drag movement
   - Commits: ce39e94, d2e006b, 5b7610c
   - Details:
     * Marching ants animation for both rectangle and lasso selections (DrawingCanvasView.swift:1020-1106)
     * CPU-based pixel extraction with proper alpha masking (CanvasRenderer.swift:1107-1464)
     * Touch-drag selection movement with real-time visual feedback (MetalCanvasView.swift:479-563)
     * Point-in-polygon hit testing for lasso selections (MetalCanvasView.swift:962-983)
     * Auto-commit on tool change to finalize moved pixels (DrawingCanvasView.swift:488-493)
     * Delete selection capability with proper history tracking
     * Selection Actions UI overlay for Cancel/Delete buttons (DrawingCanvasView.swift:192-247)
   - Feature Complete: Rectangle select, lasso select, move, delete, with full undo/redo support

ğŸŸ¨ P0 FIXES COMPLETED (October 13, 2025):

1. **No zoom** âœ… FIXED
   - Status: RESOLVED
   - Solution: Implemented full pinch-to-zoom and two-finger pan with document-space coordinate system
   - Files Modified:
     * DrawingCanvasView.swift:692-698, 1130-1176 (zoom state and coordinate transforms)
     * MetalCanvasView.swift:94-102, 164-175, 247-268, 1123-1172 (gesture handlers and touch transformation)
     * CanvasRenderer.swift:395-422 (zoom/pan rendering parameters)
     * Shaders.metal:59-101 (vertex shader zoom/pan transform)
   - Details:
     * Added zoom state management (zoomScale, panOffset, min/max constraints)
     * Implemented screenToDocument/documentToScreen coordinate transformation
     * Added UIPinchGestureRecognizer for zoom (0.1x to 10x range)
     * Added UIPanGestureRecognizer (2-finger) for canvas panning
     * All touch coordinates now transformed from screen â†’ document space
     * Metal shader applies zoom/pan transform when displaying layers
     * Zoom centered at pinch location with proper offset math
   - Feature Complete: Pinch to zoom, two-finger pan, works with all drawing tools

2. **Canvas rotation distorts drawing** âœ… FIXED
   - Status: RESOLVED
   - Solution: Implemented uniform coordinate scaling to prevent distortion on device rotation
   - Files Modified:
     * CanvasRenderer.swift:203-216 (uniform scale calculation)
     * MetalCanvasView.swift:164-175 (screen size update on rotation)
   - Details:
     * Changed from non-uniform scaling (scaleX, scaleY) to uniform scaling
     * Uses `max(screenSize.width, screenSize.height)` as reference dimension
     * Updates canvasState.screenSize when MTKView drawable size changes (rotation)
     * Drawing data stored in fixed 2048x2048 texture (document space)
     * Coordinates properly scaled from screen space â†’ texture space
   - Result: Drawings maintain correct aspect ratio and proportions regardless of device orientation

ğŸŸ¨ P0 ISSUES REMAINING:

**NONE** - All P0 issues resolved!

ğŸŸ¨ P1 ISSUES REMAINING:

1. **Landing screen loads too fast** ğŸŸ¡ NOT STARTED
   - Est. hours: 2

2. **Brush thickens on release** ğŸŸ¡ NOT STARTED
   - Est. hours: 3
   - Note: Debug logging added in CanvasRenderer.swift and MetalCanvasView.swift

ğŸŸ¨ P2 ISSUES REMAINING:

1. **Loading screen, app icon, name** ğŸŸ¡ NOT STARTED
   - Est. hours: 2â€“3

2. **Critique history** ğŸŸ¡ NOT STARTED
   - Est. hours: 4â€“6
T
3. **Auth?** ğŸŸ¡ NOT STARTED
   - Est. hours: TBD

â¸»

ğŸ“Š PROGRESS SUMMARY (Updated October 13, 2025):

âœ… Completed: 10 fixes (5 P0, 4 P1, 1 P2)
ğŸŸ¢ Remaining P0: 0 issues (ALL COMPLETE!)
ğŸŸ¡ Remaining P1: 2 issues (~5h)
ğŸŸ¡ Remaining P2: 3 issues (~6-9h + TBD)
â³ Total remaining critical path: ~5 hours for P1

ğŸ‰ MAJOR MILESTONE ACHIEVED: All P0 issues resolved!

Key achievements:
- âœ… **ALL P0 ISSUES FIXED** - Core functionality complete
- Gallery navigation fully functional
- Save/overwrite system working correctly
- Dark mode visual polish complete + toggle button implemented
- Onboarding copy refined
- Markdown rendering professional-grade
- Selection tools fully operational (rectangle, lasso, move, delete)
- **Canvas zoom with pinch gestures (P0)** - 0.1x to 10x zoom range
- **Canvas rotation fix (P0)** - No more distortion on device rotation
- Two-finger pan for canvas navigation
- Document-space coordinate system prevents visual artifacts
- Foundation stable and robust for advanced features

Next priorities (P1):
1. Landing screen loads too fast
2. Brush width stability on touchesEnded
